<!DOCTYPE html>
<html lang="ko" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<head>
    <title>회원가입</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <th:block th:include="common/head"></th:block>
</head>

<body>
    <th:block th:include="common/header"></th:block>
    <section class="vh-100" style="background-color: #eee;">
        <div class="container h-100">
            <div class="row d-flex justify-content-center align-items-center h-100">
                <div class="col-lg-12 col-xl-11">
                    <div class="card text-black" style="border-radius: 25px;">
                        <div class="card-body p-md-5">
                            <div class="row justify-content-center">
                                <div class="col-md-10 col-lg-6 col-xl-5 order-2 order-lg-1">
                                    <p class="text-center h1 fw-bold mb-5 mx-1 mx-md-4 mt-4">회원가입</p>
                                    <form class="mx-1 mx-md-4" action="/custom/join.do" method="post" onsubmit="return joinCheck(this)" name="frm1" id="frm1">
                                        <div class="d-flex flex-row align-items-center mb-4">
                                            <i class="fas fa-user fa-lg me-3 fa-fw"></i>
                                            <div class="form-outline flex-fill mb-0">
                                                <label class="form-label" for="form3Example1c">아이디</label>
                                                <input type="text" id="cusid" name="cusid" class="form-control" maxlength="12" required/>
                                                <input type="button" id="idCkBtn" class="btn btn-primary" value="아이디 중복 체크" onclick="idCheck()" style="margin-top: 4px;">
                                                <input type="hidden" name="idck" id="idck" value="no"/>
                                                <p id="msg"></p>
                                            </div>
                                        </div>
                                        <div class="d-flex flex-row align-items-center mb-4">
                                            <i class="fas fa-envelope fa-lg me-3 fa-fw"></i>
                                            <div class="form-outline flex-fill mb-0">
                                                <label class="form-label" for="form3Example3c">비밀번호</label>
                                                <input type="password" id="cuspw" name="cuspw" class="form-control" maxlength="150" required/>
                                            </div>
                                        </div>
                                        <div class="d-flex flex-row align-items-center mb-4">
                                            <i class="fas fa-envelope fa-lg me-3 fa-fw"></i>
                                            <div class="form-outline flex-fill mb-0">
                                                <label class="form-label" for="form3Example3c">비밀번호 확인</label>
                                                <input type="password" id="cuspw2" name="cuspw2" class="form-control" maxlength="150" required/>
                                            </div>
                                        </div>
                                        <div class="d-flex flex-row align-items-center mb-4">
                                            <i class="fas fa-envelope fa-lg me-3 fa-fw"></i>
                                            <div class="form-outline flex-fill mb-0">
                                                <label class="form-label" for="form3Example3c">이름</label>
                                                <input type="text" id="cusname" name="cusname" class="form-control" required/>
                                            </div>
                                        </div>
                                        <div class="d-flex flex-row align-items-center mb-4">
                                            <i class="fas fa-envelope fa-lg me-3 fa-fw"></i>
                                            <div class="form-outline flex-fill mb-0">
                                                <label class="form-label" for="form3Example3c">우편번호 및 주소</label>
                                                <input type="text" id="postcode" name="postcode" class="form-control" placeholder="우편번호" maxlength="9" style="margin-bottom: 4px;"/>
                                                <input type="text" id="address" name="address" class="form-control" maxlength="200" placeholder="주소"/>
                                                <input type="text" id="address2" name="address2" class="form-control" maxlength="200" placeholder="상세주소"/>
                                                <input type="button" id="isAddrBtn" class="btn btn-primary" value="주소 입력" onclick="findAddr()" style="margin-top: 4px;">
                                            </div>
                                        </div>
                                        <div class="d-flex flex-row align-items-center mb-4">
                                            <i class="fas fa-envelope fa-lg me-3 fa-fw"></i>
                                            <div class="form-outline flex-fill mb-0">
                                                <label class="form-label" for="form3Example3c">전화번호</label>
                                                <input type="tel" id="tel" name="tel" class="form-control" pattern="[0-9]{2,3}-[0-9]{3,4}-[0-9]{3,4}" maxlength="19" required />
                                            </div>
                                        </div>

                                        <div class="d-flex justify-content-center mx-4 mb-3 mb-lg-4">
                                            <button type="submit" class="btn btn-primary btn-lg">회원가입</button>
                                        </div>
                                    </form>

                                    <script>
                                    $(document).ready(function(){
                                        $("#cusid").keyup(function(){
                                            $("#idck").val("no");
                                            if($(this).val()!=""){
                                                $("#msg").html("<strong>아이디 입력중입니다.</strong>");
                                            } else {
                                                $("#msg").html("아직 아이디 중복 체크를 하지 않으셨습니다.");
                                            }
                                        });
                                    });
                                    </script>
                                    <script>
                                    function idCheck(){
                                        if($("#cusid").val()==""){
                                            alert("아이디를 입력하지 않으셨습니다.");
                                            $("#cusid").focus();
                                            return;
                                        } 
                                        var params = { cusid : $("#cusid").val()	} //전송되어질 데이터를 객체로 묶음
                                        $.ajax({
                                            url:"/custom/idCheck.do",	//아이디가 전송되어질 곳
                                            type:"post",		//전송방식
                                            dataType:"json",	//데이터 반환 방식
                                            data:params,		//전송방식이 post인 경우 객체로 묶어서 전송
                                            success:function(result){
                                                console.log(result.result);
                                                var idChk = result.result;	//true 또는 false를 받음
                                                if(idChk==false){	//사용할 수 없는 아이디
                                                    $("#idck").val("no");
                                                    $("#msg").html("<strong style='color:red'>기존에 사용되고 있는 아이디 입니다. 다시 입력하시기 바랍니다.</strong>");
                                                    $("#cusid").focus();
                                                } else if(idChk==true){	//사용 가능한 아이디
                                                    $("#idck").val("yes");
                                                    $("#msg").html("<strong style='color:blue'>사용가능한 아이디 입니다.</strong>");
                                                } else if(idck==""){
                                                    $("#msg").html("<strong>아이디가 확인되지 않았습니다. 다시 시도해주시기 바랍니다.</strong>");
                                                }
                                            },
                                            error : function(){
				                                alert("서버요청실패");
                                            }
                                        });
                                    }
                                    function joinCheck(f){
                                        if(f.cuspw.value!=f.cuspw2.value){
                                            alert("비밀번호와 비밀번호 확인이 서로 다릅니다.");
                                            f.pw.focus();
                                            return false;
                                        }

                                        if(f.idck.value!="yes"){
                                            alert("아이디 중복 체크를 하지 않으셨습니다.");
                                            return false;
                                        }
                                    }
                                    </script>
                                    <script>
                                        function findAddr() {
                                            new daum.Postcode({
                                                oncomplete: function(data) {
                                                    console.log(data);
                                                    var roadAddr = data.roadAddress;
                                                    var jibunAddr = data.jibunAddress;
                                                    document.getElementById("postcode").value = data.zonecode;
                                                    if(roadAddr !== '') {
                                                        document.getElementById("address").value = roadAddr;				
                                                    } else if(jibunAddr !== ''){
                                                        document.getElementById("address").value = jibunAddr;
                                                    }
                                                    document.getElementById("address2").focus();
                                                }
                                            }).open();
                                        }
                                        </script>
                                    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <th:block th:include="common/footer"></th:block>
</body>

</html>